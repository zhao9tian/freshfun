<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.quxin.freshfun.dao.ShoppingCartMapper">
  <resultMap id="BaseResultMap" type="com.quxin.freshfun.model.ShoppingCartPOJO">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="sc_id" jdbcType="INTEGER" property="scId" />
    <result column="user_id" jdbcType="BIGINT" property="userId" />
    <result column="goods_id" jdbcType="INTEGER" property="goodsId" />
    <result column="goods_totals" jdbcType="INTEGER" property="goodsTotals" />
    <result column="goods_name" jdbcType="VARCHAR" property="goodsName"/>
    <result column="goods_totals_price" jdbcType="INTEGER" property="goodsTotalsPrice" />
    <result column="pay_status" jdbcType="INTEGER" property="payStatus"/>
    <result column="is_delete" jdbcType="INTEGER" property="isDelete"/>
    <result column="create_date" jdbcType="BIGINT" property="createDate"/>
    <result column="update_date" jdbcType="BIGINT" property="updateDate"/>
    <association property="goods" column="goods_id" select="com.quxin.freshfun.dao.GoodsMapper.selectGoodsById"></association>
  </resultMap>
  
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    sc_id, user_id, goods_id, goods_totals, goods_name, goods_totals_price,pay_status
  </sql>
  <!-- 查询购物车是否存在订单 -->
  <select id="selectExistedOrder" resultType="java.lang.Integer">
      select count(sc_id) from shopping_cart where user_id = #{userId} and goods_id = #{goodsId} and is_delete = 0
  </select>
  <!-- 根据用户编号查询购物车信息 -->
  <select id="selectShoppingCartByUserId" parameterType="java.lang.Long" resultMap="BaseResultMap">
      select sc_id, user_id, goods_id, goods_totals, goods_totals_price from shopping_cart where user_id = #{userId} and pay_status = 0 and is_delete = 0
  </select>
  <!-- 根据购物车编号查询购物车信息 -->
  <select id="selectShoppingCart" parameterType="java.lang.Integer" resultType="com.quxin.freshfun.model.ShoppingCartPOJO">
      select goods_id as goodsId, goods_totals as goodsTotals, goods_name as goodsName, goods_totals_price as goodsTotalsPrice from shopping_cart where sc_id = #{scId} and is_delete = 0
  </select>
   <!-- 查询商品数量 -->
  <select id="selectGoodsTotals" parameterType="java.lang.Integer" resultType="java.lang.Integer">
      select goods_totals from shopping_cart where sc_id = #{scId} and is_delete = 0
  </select>
  <!-- 增加商品数量 -->
  <update id="addGoodsTotals" parameterType="java.lang.Integer" useGeneratedKeys="true" keyProperty="goods_totals" >
      update shopping_cart set goods_totals = goods_totals + 1 where sc_id = #{scId}
  </update>
  <!-- 减少商品数量 -->
  <update id="reduceGoodsTotals" parameterType="java.lang.Integer" useGeneratedKeys="true" keyProperty="goods_totals">
      update shopping_cart set goods_totals = goods_totals - 1 where sc_id = #{scId}
  </update>
  <update id="updateOrderPayStatus" parameterType="java.lang.Integer">
      update shopping_cart set pay_status = 1 where sc_id = #{scId}
  </update>
  <update id="delShoppingCartOrder">
      update shopping_cart set is_delete = 1,update_date=#{date} where sc_id = #{scId}
  </update>
 
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from shopping_cart
    where sc_id = #{scId,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from shopping_cart
    where sc_id = #{scId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.quxin.freshfun.model.ShoppingCartPOJO">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into shopping_cart (sc_id, user_id, goods_id, 
      goods_totals, goods_name, goods_totals_price, reserved_field
      )
    values (#{scId,jdbcType=INTEGER}, #{userId,jdbcType=INTEGER}, #{goodsId,jdbcType=INTEGER}, 
      #{goodsTotals,jdbcType=INTEGER}, #{goodsName}, #{goodsTotalsPrice,jdbcType=INTEGER},0,
      #{create_date},#{update_date}
      )
  </insert>
  <insert id="insertSelective" useGeneratedKeys="true" keyProperty="scId" parameterType="com.quxin.freshfun.model.ShoppingCartPOJO">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into shopping_cart
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="scId != null">
        sc_id,
      </if>
      <if test="userId != null">
        user_id,
      </if>
      <if test="goodsId != null">
        goods_id,
      </if>
      <if test="goodsTotals != null">
        goods_totals,
      </if>
      <if test="goodsName != null">
        goods_name,
      </if>
      <if test="goodsTotalsPrice != null">
        goods_totals_price,
      </if>
      <if test="payStatus != null">
          pay_status,
      </if>
      <if test="isDelete != null">
        is_delete,
      </if>
      <if test="createDate != null">
        create_date,
      </if>
      <if test="updateDate != null">
        update_date,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="scId != null">
        #{scId,jdbcType=INTEGER},
      </if>
      <if test="userId != null">
        #{userId,jdbcType=INTEGER},
      </if>
      <if test="goodsId != null">
        #{goodsId,jdbcType=INTEGER},
      </if>
      <if test="goodsTotals != null">
        #{goodsTotals,jdbcType=INTEGER},
      </if>
      <if test="goodsName != null">
        #{goodsName},
      </if>
      <if test="goodsTotalsPrice != null">
        #{goodsTotalsPrice,jdbcType=INTEGER},
      </if>
      <if test="payStatus != null">
        #{payStatus},
      </if>
      <if test="isDelete != null">
        #{isDelete},
      </if>
      <if test="createDate != null">
        #{createDate},
      </if>
      <if test="updateDate != null">
        #{updateDate},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.quxin.freshfun.model.ShoppingCartPOJO">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update shopping_cart
    <set>
      <if test="userId != null">
        user_id = #{userId,jdbcType=INTEGER},
      </if>
      <if test="goodsId != null">
        goods_id = #{goodsId,jdbcType=INTEGER},
      </if>
      <if test="goodsTotals != null">
        goods_totals = #{goodsTotals,jdbcType=INTEGER},
      </if>
      <if test="goodsTotalsPrice != null">
        goods_totals_price = #{goodsTotalsPrice,jdbcType=INTEGER},
      </if>
      <if test="reservedField != null">
        reserved_field = #{reservedField,jdbcType=VARCHAR},
      </if>
    </set>
    where sc_id = #{scId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.quxin.freshfun.model.ShoppingCartPOJO">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update shopping_cart
    set user_id = #{userId,jdbcType=INTEGER},
      goods_id = #{goodsId,jdbcType=INTEGER},
      goods_totals = #{goodsTotals,jdbcType=INTEGER},
      goods_totals_price = #{goodsTotalsPrice,jdbcType=INTEGER},
      reserved_field = #{reservedField,jdbcType=VARCHAR}
    where sc_id = #{scId,jdbcType=INTEGER}
  </update>
</mapper>